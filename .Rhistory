cdm$intercept |>
filter(subject_id %in% c(163, 1000)
)
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
washoutWindow = 90,
combinationWindow = c(0, Inf))
cdm$intercept |>
filter(subject_id %in% c(163, 1000))
library(CDMConnector)
library(dplyr)
library(DBI)
library(omock)
library(CohortSymmetry)
library(duckdb)
library(here)
con <- DBI::dbConnect(duckdb::duckdb(), CDMConnector::eunomia_dir())
cdm <- CDMConnector::cdm_from_con(
con = con,
cdm_schema = "main",
write_schema = "main"
)
library(DrugUtilisation)
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "aspirin",
ingredient = "aspirin")
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "acetaminophen",
ingredient = "acetaminophen")
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
combinationWindow = c(0, Inf))
cdm$intercept
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
combinationWindow = c(0, Inf))
cdm$intercept |>
summarise(min_cohort_start_date = min(cohort_start_date),
max_cohort_start_date = max(cohort_start_date),
min_cohort_end_date   = min(cohort_end_date),
max_cohort_end_date   = max(cohort_end_date))
cdm$intercept |>
inner_join(
cdm$observation_period |>
select("subject_id" = "person_id", "observation_period_start_date")
) |>
filter(subject_id %in% c(2,53))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1980-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, Inf))
cdm$intercept |>
inner_join(
cdm$observation_period |>
select("subject_id" = "person_id", "observation_period_start_date")
) |>
filter(subject_id %in% c(2,53))
cdm$aspirin |>  #1432, 3595
filter(subject_id %in% c(163, 1000))
cdm$intercept |>
filter(subject_id %in% c(163, 1000))
cdm$aspirin |>  #1432, 3595
filter(subject_id %in% c(163, 1000))
cdm$aspirin |>  #1432, 3595
filter(subject_id %in% c(1432, 3595))
cdm$intercept
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
washoutWindow = 90,
combinationWindow = c(0, Inf))
cdm$intercept |>
filter(subject_id %in% c(163, 1000))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1980-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, Inf))
cdm$intercept |> filter((cohort_end_date - cohort_start_date) < 20)
cdm$intercept
2445
cdm$intercept
cdm$intercept |>
filter(subject_id %in% c(6,2445))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, 20))
cdm$intercept |>
filter(subject_id %in% c(6,2445))
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/")
list_of_files
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/",all.files = TRUE)
list_of_files
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/",full.names = TRUE,pattern = "stepE")
list_of_files
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/breakthroughSusceptibility_logFiles/",full.names = TRUE,pattern = "stepE")
list_of_files
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/breakthroughSusceptibility_logFiles/",full.names = FALSE,pattern = "stepE")
list_of_files
!grepl("stepE-",list_of_files)
list_of_files <- list_of_files[!grepl("stepE-",list_of_files)]
list_of_files
list_of_files
gsub("stepE_","",list_of_files)
paste0("stepE-",gsub("stepE_","",list_of_files))
file.rename(from = list_of_files, to = paste0("stepE-",gsub("stepE_","",list_of_files))
)
warnings()
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/breakthroughSusceptibility_logFiles/",
full.names = TRUE,
pattern = "stepE")
list_of_files <- list_of_files[!grepl("stepE-",list_of_files)]
paste0("stepE-",gsub("stepE_","",list_of_files))
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/breakthroughSusceptibility_logFiles",
full.names = TRUE,
pattern = "stepE")
list_of_files <- list_of_files[!grepl("stepE-",list_of_files)]
list_of_files
gsub(".*logFiles/","",gsub("stepE_","",list_of_files))
paste0("stepE-",gsub(".*logFiles/","",gsub("stepE_","",list_of_files)))
gsub("logFiles/.*","",list_of_files)
paste0(gsub("logFiles/.*","",list_of_files),"logFiles/",paste0("stepE-",gsub(".*logFiles/","",gsub("stepE_","",list_of_files))))
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/breakthroughSusceptibility_logFiles",
full.names = TRUE,
pattern = "stepE")
list_of_files <- list_of_files[!grepl("stepE-",list_of_files)]
file.rename(from = list_of_files,
to   = paste0(gsub("logFiles/.*","",list_of_files),"logFiles/",paste0("stepE-",gsub(".*logFiles/","",gsub("stepE_","",list_of_files))))
)
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/oneDose_logFiles",
full.names = TRUE,
pattern = "stepE")
list_of_files
file.rename(from = list_of_files,
to   = paste0(gsub("logFiles/.*","",list_of_files),"logFiles/",paste0("stepE-",gsub(".*logFiles/","",gsub("stepE_","",list_of_files))))
)
list_of_files <- list.files("/Users/martaalcalde/Desktop/new_gwas/twoDose_logFiles",
full.names = TRUE,
pattern = "stepE")
file.rename(from = list_of_files,
to   = paste0(gsub("logFiles/.*","",list_of_files),"logFiles/",paste0("stepE-",gsub(".*logFiles/","",gsub("stepE_","",list_of_files))))
)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.width = 7,
fig.height = 5,
eval = Sys.getenv("$RUNNER_OS") != "macOS"
)
library(CDMConnector)
library(dplyr)
library(DBI)
library(omock)
library(CohortSymmetry)
library(duckdb)
library(here)
con <- DBI::dbConnect(duckdb::duckdb(), CDMConnector::eunomia_dir())
cdm <- CDMConnector::cdm_from_con(
con = con,
cdm_schema = "main",
write_schema = "main"
)
library(DrugUtilisation)
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "aspirin",
ingredient = "aspirin")
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "acetaminophen",
ingredient = "acetaminophen")
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
washoutWindow = 90,
combinationWindow = c(0, Inf))
cdm
library(CDMConnector)
library(dplyr)
library(DBI)
library(omock)
library(CohortSymmetry)
library(duckdb)
library(here)
con <- DBI::dbConnect(duckdb::duckdb(), CDMConnector::eunomia_dir())
cdm <- CDMConnector::cdm_from_con(
con = con,
cdm_schema = "main",
write_schema = "main"
)
library(DrugUtilisation)
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "aspirin",
ingredient = "aspirin")
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "acetaminophen",
ingredient = "acetaminophen")
knitr::include_graphics(here("vignettes/figures/1-NoRestrictions.png"))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept")
cdm$intercept
knitr::include_graphics(here("vignettes/figures/2-studyPeriod.png"))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
combinationWindow = c(0, Inf))
cdm$intercept |>
summarise(min_cohort_start_date = min(cohort_start_date),
max_cohort_start_date = max(cohort_start_date),
min_cohort_end_date   = min(cohort_end_date),
max_cohort_end_date   = max(cohort_end_date))
cdm$intercept |>
inner_join(
cdm$observation_period |>
select("subject_id" = "person_id", "observation_period_start_date")
) |>
filter(subject_id %in% c(2,53))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1980-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, Inf))
cdm$intercept |>
inner_join(
cdm$observation_period |>
select("subject_id" = "person_id", "observation_period_start_date")
) |>
filter(subject_id %in% c(2,53))
cdm
cdm[["aspirin"]]
library(DrugUtilisation)
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "aspirin",
ingredient = "aspirin")
library(CDMConnector)
library(dplyr)
library(DBI)
library(omock)
library(CohortSymmetry)
library(duckdb)
library(here)
con <- DBI::dbConnect(duckdb::duckdb(), CDMConnector::eunomia_dir())
cdm <- CDMConnector::cdm_from_con(
con = con,
cdm_schema = "main",
write_schema = "main"
)
library(DrugUtilisation)
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "aspirin",
ingredient = "aspirin")
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "acetaminophen",
ingredient = "acetaminophen")
cdm$aspirin |> filter(year(cohort_start_date) %in% c(1950,1949))
cdm$aspirin |> filter(year(cohort_start_date) %in% c(1950,1949)) |> group_by(subject_id) |> filter(n() > 1)
cdm$aspirin |> filter(year(cohort_start_date) %in% c(1950,1945)) |> group_by(subject_id) |> filter(n() > 1)
cdm[["aspirin"]] |>
filter(subject_id %in% c(1609,3565))
cdm[["aspirin"]] |>
filter(subject_id %in% c(1609,3565))
cdm[["aspirin"]] |>
filter(subject_id %in% c(1609,3565)) |>
arrange(subject_id, cohort_start_date)
cdm[["aspirin"]] |>
filter(subject_id %in% c(1609,3565)) |>
arrange(subject_id, cohort_start_date)
cdm[["aspirin"]] |>
filter(subject_id %in% c(1609,3565)) |>
arrange(subject_id, cohort_start_date)
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
washoutWindow = 0,
combinationWindow = c(0, Inf))
cdm[["intercept"]] |>
filter(subject_id %in% c(1609,3565)) |>
arrange(subject_id, cohort_start_date)
cdm[["aspirin"]] |>
filter(subject_id %in% c(1609,3565)) |>
arrange(subject_id, cohort_start_date)
as.Date("1950-10-13")-as.Date("1949-03-17")
cdm$aspirin |> filter(year(cohort_start_date) %in% c(1950,1949)) |> group_by(subject_id) |> filter(n() > 1)
cdm$aspirin |> filter(year(cohort_start_date) %in% c(1950,1949)) |> group_by(subject_id) |> filter(n() > 1) |> print(n = 100)
as.Date("1950-10-29")-as.Date("1949-10-21")
as.Date("1950-12-04")-as.Date("1950-12-04")
as.Date("1950-12-04")-as.Date("1949-05-13")
as.Date("1950-05-06")-as.Date("1949-10-08")
cdm[["aspirin"]] |>
filter(subject_id %in% c(1950,3565)) |>
arrange(subject_id, cohort_start_date)
cdm[["aspirin"]] |>
filter(subject_id %in% c(1936,3565)) |>
arrange(subject_id, cohort_start_date)
cdm[["aspirin"]] |>
filter(subject_id %in% c(1936,3565)) |>
arrange(subject_id, cohort_start_date)
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
washoutWindow = 0,
combinationWindow = c(0, Inf))
cdm[["intercept"]] |>
filter(subject_id %in% c(1936,3565)) |>
arrange(subject_id, cohort_start_date)
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
washoutWindow = 365,
combinationWindow = c(0, Inf))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
washoutWindow = 365,
combinationWindow = c(0, Inf))
cdm[["intercept"]] |>
filter(subject_id %in% c(1936,3565)) |>
arrange(subject_id, cohort_start_date)
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, 90))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept1",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, 90))
cdm$intercept |> anti_join(cdm$intercept)
cdm$intercept1
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept1",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, 365))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept1",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, 0))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept1",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, 1))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept1",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, Inf))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept1",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, 365))
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
cohortDateRange = as.Date(c("1950-01-01","1969-01-01")),
daysPriorObservation = 365,
combinationWindow = c(0, Inf))
cdm$intercept |> anti_join(cdm$intercept1)
devtools::load_all()
devtools::load_all()
devtools::check()
devtools::check()
usethis::use_package("here")
renv::activate()
renv::snapshot()
usethis::edit_r_environ()
library(CohortSymmetry)
usethis::use_vignette("a03_Summarise_sequence_ratio")
help(summariseSequenceRatio)
devtools::load_all()
help(summariseSequenceRatio)
help("generateSequenceCohortSet")
# Load libraries
library(CDMConnector)
library(dplyr)
library(DBI)
library(omock)
library(CohortSymmetry)
library(duckdb)
library(DrugUtilisation)
# Connect to the database
db <- DBI::dbConnect(duckdb::duckdb(),
dbdir = CDMConnector::eunomia_dir())
cdm <- cdm_from_con(
con = db,
cdm_schema = "main",
write_schema = "main"
)
# Generate cohorts
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "aspirin",
ingredient = "aspirin")
cdm <- DrugUtilisation::generateIngredientCohortSet(
cdm = cdm,
name = "acetaminophen",
ingredient = "acetaminophen")
# Generate a sequence cohort
cdm <- generateSequenceCohortSet(
cdm = cdm,
indexTable = "aspirin",
markerTable = "acetaminophen",
name = "intercept",
combinationWindow = c(0,Inf))
summariseSequenceRatio(
cdm = cdm,
sequenceTable = "aspirin"
)
summariseSequenceRatio(
cdm = cdm,
sequenceTable = "aspirin"
)
summariseSequenceRatio(
cdm = cdm,
sequenceTable = "intercept"
)
summariseSequenceRatio(
cdm = cdm,
sequenceTable = "intercept"
)
help(summariseSequenceRatio)
